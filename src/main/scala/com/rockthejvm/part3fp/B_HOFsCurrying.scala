package com.rockthejvm.part3fp

import scala.annotation.tailrec

object B_HOFsCurrying {

  // ==========================================================
  // ğŸŒŸ é«˜é˜¶å‡½æ•°ï¼ˆHigher-Order Function, HOFï¼‰
  // ==========================================================
  // å®šä¹‰ï¼šé«˜é˜¶å‡½æ•°æ˜¯ã€Œæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€
  //       æˆ–è€…ã€Œè¿”å›ä¸€ä¸ªå‡½æ•°ä½œä¸ºç»“æœã€çš„å‡½æ•°ã€‚
  //       ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°ä¸å†åªå¤„ç†â€œæ•°å­—â€æˆ–â€œå­—ç¬¦ä¸²â€ï¼Œ
  //       è€Œæ˜¯å¯ä»¥å¤„ç†â€œå‡½æ•°â€æœ¬èº«ï¼ˆå› ä¸ºå‡½æ•°åœ¨ Scala é‡Œæ˜¯ä¸€ä¸ªå€¼ï¼‰ã€‚

  // ==========================================================
  // ğŸ§© ç¤ºä¾‹ 1ï¼šæ¥å—å‡½æ•°ä½œä¸ºå‚æ•°çš„é«˜é˜¶å‡½æ•°
  // ==========================================================

  // å‡½æ•°ç±»å‹è¯´æ˜ï¼š
  // (Int, (Int => Int)) => Int
  // è§£é‡Šï¼š
  //  - è¿™ä¸ªå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼š
  //      1ï¸âƒ£ ä¸€ä¸ª Int ç±»å‹çš„æ•°å­—ï¼ˆä¾‹å¦‚ 5ï¼‰
  //      2ï¸âƒ£ ä¸€ä¸ªå‡½æ•°å‚æ•° (Int => Int)ï¼Œä»£è¡¨â€œè¾“å…¥ Intï¼Œè¾“å‡º Intâ€
  //  - å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª Int

  val aHof: (Int, (Int => Int)) => Int = (x, func) => {
    // è¿™é‡Œçš„ "func" æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥ç›´æ¥è¢«è°ƒç”¨
    // ä¸¾ä¾‹ï¼šå¦‚æœ func = (n => n * 2)
    // é‚£ä¹ˆ func(5) å°±æ˜¯ 10

    // æˆ‘ä»¬è¿™é‡Œç®€å•ç¤ºèŒƒï¼Œåªè¿”å› x + 1ï¼ˆæ²¡çœŸæ­£ç”¨ funcï¼‰
    x + 1
  }

  // è°ƒç”¨æ–¹å¼ç¤ºä¾‹
  val result1 = aHof(10, n => n * 2) // ä¼ å…¥æ•°å­— 10 å’Œä¸€ä¸ªâ€œä¹˜2â€çš„å‡½æ•°
  println(result1) // è¾“å‡º 11 ï¼ˆå› ä¸ºæˆ‘ä»¬å†™çš„æ˜¯ x + 1ï¼‰


  // ==========================================================
  // ğŸ§© ç¤ºä¾‹ 2ï¼šè¿”å›ä¸€ä¸ªå‡½æ•°çš„é«˜é˜¶å‡½æ•°ï¼ˆå‡½æ•°çš„å‡½æ•°ï¼‰
  // ==========================================================

  // å‡½æ•°ç±»å‹è¯´æ˜ï¼š
  // Int => (Int => Int)
  // è§£é‡Šï¼š
  //  - æ¥æ”¶ä¸€ä¸ª Intï¼ˆä¾‹å¦‚ xï¼‰
  //  - è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¿™ä¸ªæ–°å‡½æ•°æ¥æ”¶ Intï¼ˆä¾‹å¦‚ yï¼‰å¹¶è¿”å› Int

  val anotherHof: Int => (Int => Int) = x => {
    // è¿™ä¸ª lambda è¿”å›â€œå¦ä¸€ä¸ªå‡½æ•°â€
    (y => y + 2 * x)
  }

  // è°ƒç”¨æ–¹å¼ï¼ˆåˆ†ä¸¤æ­¥è°ƒç”¨ï¼‰ï¼š
  val newFunc = anotherHof(3) // ä¼ å…¥ x = 3ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•° y => y + 6
  val result2 = newFunc(4) // è°ƒç”¨è¿”å›çš„å‡½æ•°ï¼Œä¼ å…¥ y = 4
  println(result2) // è¾“å‡º 10 ï¼ˆå› ä¸º 4 + 2*3 = 10ï¼‰

  // ä¹Ÿå¯ä»¥ä¸€æ­¥å†™å®Œï¼ˆè¿ç€ä¸¤å±‚è°ƒç”¨ï¼‰ï¼š
  val result3 = anotherHof(3)(4) // ç­‰ä»·äºä¸Šé¢ä¸¤æ­¥
  println(result3) // 10

  // âœ… å°ç»“ï¼š
  // è¿™ä¸ªæ¨¡å¼å«â€œæŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰â€æˆ–â€œå‡½æ•°åµŒå¥—è°ƒç”¨â€ã€‚
  // æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤šå±‚å‡½æ•°è¿”å›ï¼Œé€æ­¥ç”Ÿæˆæ›´å…·ä½“çš„å‡½æ•°ã€‚


  // ==========================================================
  // ğŸ§© ç¤ºä¾‹ 3ï¼šåµŒå¥—ç±»å‹çš„é«˜é˜¶å‡½æ•°
  // ==========================================================

  // å‡½æ•°ç±»å‹è¯´æ˜ï¼š
  // (Int, (String, (Int => Boolean)) => Int) => (Int => Int)
  // æ‹†è§£è§£é‡Šï¼š
  // è¿™ä¸ªå‡½æ•° superfunction æœ‰ä¸¤ä¸ªè¾“å…¥ï¼š
  //   1ï¸âƒ£ ä¸€ä¸ª Intï¼ˆä¾‹å¦‚ xï¼‰
  //   2ï¸âƒ£ ä¸€ä¸ªå¤æ‚çš„å‡½æ•°å‚æ•° func
  //         func çš„ç±»å‹æ˜¯ (String, (Int => Boolean)) => Int
  //         â†’ æ¥æ”¶ä¸€ä¸ª String å’Œä¸€ä¸ªå‡½æ•° (Int => Boolean)ï¼Œè¿”å› Int
  //
  // ç„¶å superfunction æœ¬èº«ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼š
  //   (Int => Int)ï¼Œä¹Ÿå°±æ˜¯â€œè¾“å…¥ä¸€ä¸ª Intï¼Œè¿”å›ä¸€ä¸ª Intâ€

  val superfunction: (Int, (String, (Int => Boolean)) => Int) => (Int => Int) = {
    (x, func) => // é€™è£¡æ¥æ”¶å…©å€‹åƒæ•¸ï¼šä¸€å€‹æ•¸å­— xã€ä¸€å€‹å‡½æ•¸ func
      (y => x + y) // è¿”å›ä¸€å€‹æ–°å‡½æ•¸ï¼ˆæ¥æ”¶ yï¼Œè¼¸å‡º x + yï¼‰
  }

  // é€™è£¡å‚³å…¥ x = 3ï¼Œfunc æ˜¯å€‹æ²’ç”¨åˆ°çš„å‡å‡½æ•¸ (_,_) => 100
  val super1 = superfunction(3, (_, _) => 100)

  // super1 ç¾åœ¨æ˜¯ä¸€å€‹æ–°å‡½æ•¸ï¼š (Int => Int)
  val super2 = super1(4) // ç›¸ç•¶æ–¼è¨ˆç®— 3 + 4 = 7
  println(super2) // è¾“å‡º 7


  // -----------------------------
  // ğŸŒŸ é«˜é˜¶å‡½æ•°ç¤ºä¾‹
  // -----------------------------
  // é«˜é˜¶å‡½æ•°æŒ‡ï¼šæ¥æ”¶å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªå‡½æ•°ä½œä¸ºç»“æœçš„å‡½æ•°ã€‚
  // å¸¸è§ä¾‹å­ï¼šmapã€flatMapã€filter ç­‰
  // å®ƒä»¬éƒ½å±äºâ€œæ¥æ”¶å‡½æ•°ä½œä¸ºå‚æ•°â€çš„å…¸å‹ä»£è¡¨

  // -----------------------------
  // ğŸŒŸ æŸ¯é‡ŒåŒ– (Currying)
  // -----------------------------
  // å°†ä¸€ä¸ªå¤šå‚æ•°å‡½æ•°è½¬æ¢æˆä¸€è¿ä¸²å•å‚æ•°å‡½æ•°
  // ä¾‹å¦‚ï¼š (x, y) => x + y å˜ä¸º x => (y => x + y)
  val superAdder: Int => Int => Int = (x: Int) => (y: Int) => x + y
  val add2 :(Int,Int)=> Int = (x: Int, y: Int) => x + y // æ™®é€šå‡½æ•°
  
  val add3: Int => Int = superAdder(3)    // å›ºå®š x=3ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•° y => 3 + y
  val invokeSuperAdder = superAdder(3)(100) // ä¸€æ¬¡æ€§è°ƒç”¨ï¼Œç»“æœ 103

  // -----------------------------
  // ğŸŒŸ æŸ¯é‡ŒåŒ–æ–¹æ³• (Curried Method)
  // -----------------------------
  // æ–¹æ³•ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªå‚æ•°åˆ—è¡¨
  //fmt æ˜¯å‚³å…¥çš„æ ¼å¼å­—ä¸² , x æ˜¯è¦æ ¼å¼åŒ–çš„æ•¸å­—
  def curriedFormatter(fmt: String)(x: Double): String = fmt.format(x)

  val standardFormat: Double => String = curriedFormatter("%4.2f")  // æ ¼å¼åŒ–ä¸º 2 ä½å°æ•°
  val preciseFormat: Double => String = curriedFormatter("%10.8f")  // æ ¼å¼åŒ–ä¸º 8 ä½å°æ•°

  //ã€ç»ƒä¹ ã€‘
  // -----------------------------
  // ğŸŒŸ å‡½æ•°æŸ¯é‡ŒåŒ–è½¬æ¢
  // toCurry: å°†ä¸€ä¸ªäºŒå…ƒå‡½æ•°è½¬æ¢ä¸ºæŸ¯é‡ŒåŒ–å‡½æ•°
  // fromCurry: å°†ä¸€ä¸ªæŸ¯é‡ŒåŒ–å‡½æ•°è½¬æ¢ä¸ºäºŒå…ƒå‡½æ•°
  // -----------------------------
  def toCurry(f: (Int, Int) => Int): Int => Int => Int = x => y => f(x, y)

  val superAdder_v2 = toCurry(_ + _)


  def fromCurry(f: Int => Int => Int): (Int, Int) => Int =
    (x, y) => f(x)(y)

  val simpleAdder = fromCurry(superAdder)

  //ã€ç»ƒä¹ ã€‘
  // -----------------------------
  // ğŸŒŸ å‡½æ•°ç»„åˆ (Function Composition)
  // -----------------------------
  // compose(f, g): å…ˆæ‰§è¡Œ gï¼Œå†æ‰§è¡Œ f, f(g(x))
  // andThen(f, g): å…ˆæ‰§è¡Œ fï¼Œå†æ‰§è¡Œ g, g(f(x))
  def compose[A, B, C](f: B => C, g: A => B): A => C =
    x => f(g(x))

  def andThen[A, B, C](f: A => B, g: B => C): A => C =
    x => g(f(x))

  val incrementer = (x: Int) => x + 1
  val doubler = (x: Int) => 2 * x

  val composedApplication = compose(incrementer, doubler)   // incrementer(doubler(x))
  val aSequencedApplication = andThen(incrementer, doubler) // doubler(incrementer(x))

  // -----------------------------
  // ä¸»ç¨‹åºå…¥å£
  // -----------------------------
  def main(args: Array[String]): Unit = {
    println(standardFormat(Math.PI))  // æ ¼å¼åŒ–è¾“å‡º Ï€ (ä¸¤ä½å°æ•°)
    println(preciseFormat(Math.PI))   // æ ¼å¼åŒ–è¾“å‡º Ï€ (å…«ä½å°æ•°)
    println(simpleAdder(2, 78))       // 80
    println(composedApplication(14))  // 29 = 2*14 + 1
    println(aSequencedApplication(14)) // 30 = (14+1)*2
  }
}
